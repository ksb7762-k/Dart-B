# 선택편향
관측 데이터를 선택하는 방식 때문에 생기는 편향 

### 데이터 스누핑(Data Snooping)

**데이터 스누핑**이란, 뭔가 흥미로운 것을 찾아 광범위하게 데이터를 살피는것  


snoop이 기웃거리다, 염탐하다라는 동사! 

## 📊 실무 중심 데이터 분석 총정리: 스누핑 방지부터 클래스 불균형까지

---

### ✅ 1. EDA와 피처 엔지니어링의 구분

- EDA는 탐색 목적이며, 변수 간 관계나 분포를 확인하는 과정임
- 변수 선택, 제거, 변환 등의 결정은 EDA에서 바로 하지 않고, train 내에서 검증 후 수행해야 함
- Y와의 관계를 보는 것은 필수지만, 그걸 기반으로 즉시 피처를 제거하면 스누핑 위험이 있음

---

### ✅ 2. 스누핑(Data Snooping) 위험 요소

- Y 기준으로 피처 제거/변환/선택 → 정보 유출 발생
- 결측치 채움, 이상치 제거, 스케일링 등도 train 기준으로만 수행해야 안전함
- test는 오직 최종 평가용으로, 어떤 기준 수립에도 참여하면 안 됨

---

### ✅ 3. Train-Test Split 시점

- **가장 안전한 시점은 EDA 이전**
- test는 완전히 blind한 상태로 두어야, 일반화 성능을 올바르게 평가할 수 있음
- 이후 모든 분석, 전처리, 튜닝은 train 내부에서만 진행함

---

### ✅ 4. 결측치, 이상치, 스케일링 처리 원칙

| 항목     | 기준 수립 위치 | test 적용 여부 | 설명                         |
|----------|----------------|----------------|------------------------------|
| 결측치   | train          | ✅              | train 평균 등으로 채움        |
| 이상치   | train          | ✅              | train 기준 범위로 제거/마스킹 |
| 스케일링 | train          | ✅              | train 평균/표준편차 사용      |
| SMOTE    | train only     | ❌              | test에 synthetic 샘플 생성 금지 |

---

### ✅ 5. 클래스 불균형 처리

- 클래스 불균형 해결(SMOTE, undersampling, class_weight 등)은 **train에만 적용**
- test는 현실 그대로 유지해야 실제 운영 환경에서의 성능을 반영함
- 평가 지표는 정확도보다 F1-score, recall, AUC 등을 활용해야 함

---

### ✅ 6. 왜 test에는 SMOTE를 적용하면 안 되는가?

- SMOTE는 새로운 데이터를 생성하는 행위 → 학습 과정에 해당됨
- test에는 정보 "적용"은 가능하지만, 정보 "생성/변형"은 절대 금지됨
- 반면, 결측치 처리나 스케일링은 단순히 기준을 적용하는 것이므로 허용됨

---

### ✅ 7. test와 train의 데이터 분포가 다르면?

- test를 조작해서 train과 맞추면 안 됨 → 평가 왜곡 발생
- 해결책은 다음과 같음:

| 전략                              | 설명 |
|-----------------------------------|------|
| train 데이터 확장 또는 재샘플링      | test와 비슷한 분포를 train에 포함시킴 |
| 도메인 적응 / 샘플 가중치 조정      | covariate shift 보정                   |
| robust 모델 설계                   | 분포 변화에 민감하지 않은 알고리즘 사용 |
| test와 유사한 validation 구성       | 모델 선택 기준을 test와 유사하게 조정  |

---

### ✅ 8. 실무 vs Kaggle 차이

| 항목               | 실무 기준                          | Kaggle 기준                        |
|--------------------|------------------------------------|------------------------------------|
| test 사용 목적      | 진짜 성능 검증                      | 제출 점수 확인용                    |
| split 시점          | EDA 전에                             | EDA 후 validation split           |
| 정보 유출 기준      | 매우 엄격                             | 상대적으로 완화                     |
| 평가 방식           | 재현 가능하고 현실 반영              | leaderboard 기준 반복 최적화       |

---

### ✅ 최종 핵심 원칙 요약

1. test는 EDA 전 분리, 절대 가공 금지
2. 모든 기준 수립은 train 내에서만
3. 결측치/이상치/스케일링은 train 기준 → test에 적용만
4. SMOTE 등 데이터 생성 방식은 train 전용
5. test 분포가 달라도 test는 그대로 두고, train을 보정하거나 모델을 강건하게 설계
6. 평가 지표는 불균형에 강한 f1, recall, AUC 중심 사용

→ 이 원칙을 지켜야 신뢰 가능한 모델 평가와 일반화가 가능함


## 2.2.1 평균으로의 회귀 

평균으로의 회귀란 주어진 어떤 변수를 연속적으로 측정했을 때 나타나는 현상  
예외적인 경우가 관찰되면 그다음에는 중간 정도의 경우가 관찰되는 현상  
따라서 예외 경우를 너무 특별히 생각하고 의미를 부여하면 선택편향으로 이어질 수 있음 

예시)  
 프로야구 신인왕 수상자의 2년 차 슬럼프   
성적으로 신인을 뽑을 떄, 진짜 실력도 있지만 동시에 운도 따랐을 것  
다음 시즌에는 실력은 그래도 유지되지만, 대부분의 경우 운은 그렇지 않음  
따라서 성적은 나빠질 것  

## 2.3 통계학에서의 표본분포  

표본분포 : 하나의 동일한 모집단에서 얻은 여러 샘플에 대한 **표본통계량**의 분포  

흔히 **데이터 분포**라고 알려진 개별 데이터 포인트의 분포와 **표본분포**라고 알려진 표본통계량의 분포를 구별하는 것이 중요함  

평균과 같은 표본통계량의 분포는 데이터 자체의 분포보다 규칙적이고 종 모양일 가능성이 높음   

표본이 클수록 그럴 가능성이 더 높아지고 표본통계량의 분포가 좁아짐  

이러한 현상을 **중심극한정리**라고 함  


### F분포란?  (아직 좀 더 공부필요)
---

### ANOVA (분산분석)이란? (이것도)

- ANOVA는 **세 집단 이상**의 평균이 서로 같은지 비교하는 방법임    
- 이름은 “Analysis of Variance”지만, 실제로는 **평균 차이**를 보는 검정임  

#### ✅ 기본 아이디어  

> "집단 간 차이(변동)가 집단 내 차이보다 크면 → 평균이 다르다!"  

#### ✅ 분해 구조  
- **총 변동** = **집단 간 변동(Mean 차이)** + **집단 내 변동(개인차 등)**  
- F값 = **집단 간 분산 / 집단 내 분산**  
- 이 F값이 클수록 → 집단 간 평균 차이가 크다고 판단  

---

### 요약  

| 항목 | F분포 | ANOVA (분산분석) |
|------|--------|-------------------|
| 목적 | 분산비를 보기 위한 분포 | 세 집단 이상 평균 비교 |
| 쓰임 | 검정통계량의 분포 | 평균 차이가 유의한지 검정 |
| 관련성 | ANOVA에서 계산한 F값이 따르는 분포 | F분포 기반 검정 |
| 결과 | F값이 크면 귀무가설 기각 | “세 그룹 평균은 다르다” 결론 가능 |

---

### 결론 한 줄

> ✔️ **ANOVA는 여러 그룹의 평균을 비교하는 분석이고**,  
> ✔️ **F분포는 그 분석에서 얻은 통계량이 따르는 분포!**

### 포아송 분포, 지수 분포, 베이불 분포 쉽게 비교하기

#### ✅ 공통점
- 셋 다 **"어떤 사건이 언제, 얼마나 자주 발생하느냐"**와 관련된 확률 분포임
- 특히 **고장, 사고, 고객 도착, 대기 시간** 같은 이벤트 분석에 자주 쓰임

---

### 1. 포아송 분포 (Poisson Distribution)

> ✔️ 단위 시간/공간당 **사건 발생 횟수**를 셈  
> 예: 1시간에 콜센터에 전화가 몇 통 오는가?

- 특징: 정수값(0, 1, 2, ...)에 대한 확률 분포
- 입력: 평균 발생 횟수(λ, 람다)
- 예: 하루 평균 5건 사고가 나면, 오늘 3건 날 확률은?

---

### 2. 지수 분포 (Exponential Distribution)

> ✔️ **두 사건 사이의 시간 간격**을 모델링함  
> 예: 다음 고객이 도착할 때까지 얼마나 걸리는가?

- 특징: 연속형 분포 (시간, 거리 등)
- 포아송 분포의 “대기 시간 버전”
- 입력: 평균 발생률(λ) → 기다릴 시간의 분포로 바뀜
- 예: 사고가 평균 1시간마다 난다면, 다음 사고까지 30분 이내일 확률은?

---

### 3. 베이불 분포 (Weibull Distribution)

> ✔️ 고장이나 수명의 분포를 더 유연하게 모델링  
> 예: 제품이 시간이 지날수록 고장날 확률이 높아진다면?

- 특징: 지수 분포보다 더 다양한 형태 가능
- 입력: **형상(모양) 파라미터 k**, **스케일 파라미터 λ**
  - k = 1 → 지수분포와 같음
  - k > 1 → 시간이 지날수록 고장 확률 증가
  - k < 1 → 시간이 지날수록 고장 확률 감소
- 예: 전구 수명, 기계 부품의 고장 시점 예측

---

### 요약 비교

| 분포 | 무엇을 모델링? | 예시 | 주요 특징 |
|------|------------------|------|-------------|
| 포아송 | 일정 시간당 사건 수 | 1시간에 전화 몇 통 | 정수 개수 셈 |
| 지수 | 사건 사이 시간 | 다음 사고까지 몇 분? | 연속형, 메모리 없음 |
| 베이불 | 수명/고장 시점 | 기계가 언제 고장날까 | 고장률 변화 반영 가능 |

---

> 📌 포아송 = 사건 수  
> 📌 지수 = 다음 사건까지 대기 시간  
> 📌 베이불 = 수명과 고장 패턴까지 고려한 유연한 시간 분포
